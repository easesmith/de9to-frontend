import{j as e,B as $,a as te,r as d,u as se,D as ae,m as le,n as oe,o as re,l as ne,_ as ce}from"./index-DmouPCTn.js";import{z as y,u as de,F as ie,b as ue,c as xe,d as me,e as fe,f as be,L as he}from"./usePostApiReq-Bc5-sulw.js";import{S as ge,a as pe,b as je,c as Se,d as ye,e as ve}from"./select-CbMVavr5.js";import{t as Ne}from"./zod-CUky7xw4.js";import{d as we,e as Ce}from"./Header-BT9ardL7.js";import{f as g}from"./format-CW0G_LzU.js";import{a as De}from"./addDays-BmrnjbS8.js";const Pe=u=>{if(u.length===0)return 0;const b=u.reduce((h,m)=>h+Number(m==null?void 0:m.patientRating),0)/(u==null?void 0:u.length);return Number(b)},Ee="/assets/Vector%20(7)-8ZgEcU2B.png",Ae=({title:u,slots:x,selectedSlot:b,handleSlotClick:h,dayDate:m})=>e.jsx("div",{className:"grid w-full gap-3",children:(x==null?void 0:x.length)>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))] w-full gap-2",children:x.map((a,v)=>{var n,p,i;return e.jsx($,{type:"button",variant:"secondary",className:`border-2 ${b===((n=a==null?void 0:a.slotId)==null?void 0:n.startTime)?"bg-[#95C22B] hover:bg-[#95C22B] text-white":""} text-xs sm:text-base`,onClick:()=>{var D,N;return h((D=a==null?void 0:a.slotId)==null?void 0:D.startTime,m,(N=a==null?void 0:a.slotId)==null?void 0:N._id)},disabled:(p=a==null?void 0:a.slotId)==null?void 0:p.isBooked,children:(i=a==null?void 0:a.slotId)==null?void 0:i.startTime},v)})}):e.jsx("p",{className:"text-red-500",children:"No slots available"})}),Be=y.object({clinic:y.string().min(1,"Please select a clinic"),date:y.string().min(1,"Please select a date"),time:y.string().min(1,"Please select a time slot"),dentistId:y.string().optional()}),Ge=({isConfirmBookingModalOpen:u,setIsConfirmBookingModalOpen:x,selectedDate:b,selectedTime:h,selectedIndex:m,clinic:a="",dentistId:v,timing:n})=>{const p=te(),i=de({resolver:Ne(Be),defaultValues:{clinic:(a==null?void 0:a._id)||"",date:b||"",time:h||"",dentistId:v||""}});console.log("timing:",n);const{reset:D,handleSubmit:N,getValues:w}=i,T=s=>{console.log("Booking Data:",s);const t=ne("userInfo");if(!t||!(t!=null&&t.userId)){ce.error("Please login first"),p("/");return}x(!1),p("/confirm-booking",{state:{data:s,clinicDetails:a,slotId:G,timing:n,startIndex:o}})},[P,E]=d.useState(h),[G,q]=d.useState(""),[V,_]=d.useState([]),[j,C]=d.useState(b||g(new Date,"yyyy-MM-dd")),[M,A]=d.useState(m||"selected0"),[o,B]=d.useState(m),r=(s=>Array.from({length:s},(t,l)=>{const k=De(new Date,l),S=g(k,"EEEE"),Q=g(k,"yyyy-MM-dd"),W=l===0?"Today":l===1?"Tomorrow":g(k,"EEE, dd MMM"),X=n==null?void 0:n.filter(f=>(f==null?void 0:f.day.toLowerCase())===(S==null?void 0:S.toLowerCase())),ee=n==null?void 0:n.some(f=>{var L;return f.day.toLowerCase()===S.toLowerCase()&&((L=f==null?void 0:f.slot)==null?void 0:L.length)>0});return{name:W,date:Q,day:S,slotsAvailable:ee,slots:X[0]||""}}))(7);console.log(r);const z=(s,t,l)=>{E(s),q(l),C(t),i.setValue("time",s),i.setValue("date",t)},H=s=>{A(`selected${s}`),E("");const t=r[s].date;C(t),i.setValue("date",t)},R=s=>{A(`selected${s}`),E(""),B(s);const t=r[s].date;C(t),i.setValue("date",t)},F=s=>{const t=r.findIndex(l=>l.date===s);for(let l=t+1;l<r.length;l++)if(r[l].slotsAvailable)return{name:r[l].name,index:l};return null},U=()=>{o+3<r.length&&B(o+3)},Y=()=>{o>0&&B(o-3)},[Z,J]=d.useState([]);d.useEffect(()=>{var l;const s=r.slice(o,o+3);J(s),A(`selected${o}`);const t=(l=r[o])==null?void 0:l.date;C(t)},[o]);const{res:c,fetchData:K,isLoading:Ie,error:I}=se(),O=async()=>{K(`/patient/get-dentist-available-timing?clinicId=${w("clinic")}&dentistId=${v}&day=${g(new Date(j),"EEEE")}&date=${g(new Date(j),"dd-MM-yyy")}`)};return d.useEffect(()=>{w("clinic")&&O()},[j,w("clinic")]),d.useEffect(()=>{var s,t;((c==null?void 0:c.status)===200||(c==null?void 0:c.status)===201)&&(_((t=(s=c==null?void 0:c.data)==null?void 0:s.data)==null?void 0:t.availableSlots),console.log("slotsRes response",c))},[c]),d.useEffect(()=>{I&&(console.log("slotsRes error",I),_([]))},[I]),e.jsx(ae,{open:u,onOpenChange:x,children:e.jsx(le,{className:"max-w-[700px] max-h-[90vh] overflow-y-auto w-full",children:e.jsxs(oe,{className:"text-left",children:[e.jsx(re,{className:"font-inter font-medium text-[#0D0E0E] text-base sm:text-2xl ",children:"Confirm Your Booking"}),e.jsx(ie,{...i,children:e.jsxs("form",{onSubmit:N(T),className:"flex flex-col items-start gap-4 w-full",children:[a&&a.length>0&&e.jsx("div",{className:"w-full",children:e.jsx(ue,{control:i.control,name:"clinic",render:({field:s})=>e.jsxs(xe,{children:[e.jsx(me,{className:"font-inter text-sm sm:text-base text-left sm:text-left",children:"Select Clinic"}),e.jsx(fe,{children:e.jsxs(ge,{value:s.value,onValueChange:s.onChange,children:[e.jsx(pe,{className:"w-full border bg-[#F9FFEA] border-[#95C22B]",children:e.jsx(je,{placeholder:"Select clinic"})}),e.jsx(Se,{className:"border border-[#95C22B] rounded-lg py-[10px]",children:e.jsx(ye,{children:a.map(t=>e.jsx(ve,{value:t==null?void 0:t._id,children:t==null?void 0:t.clinicName},t==null?void 0:t._id))})})]})}),e.jsx(be,{})]})})}),w("clinic")&&e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"font-inter text-sm sm:text-base border-b pb-2 border-b-[#71717154] w-full",children:"Select Availability"}),e.jsxs("div",{className:"grid w-full gap-4 grid-cols-[10%_1fr_10%]",children:[e.jsx("button",{type:"button",className:"flex justify-center items-center disabled:text-gray-300",onClick:Y,disabled:o===0,children:e.jsx(we,{className:"border w-14 h-14 p-2 sm:p-4 rounded-full"})}),e.jsx("div",{className:"grid w-full gap-4 grid-cols-[1fr_1fr_1fr]",children:Z.map((s,t)=>{const l=s.date===j&&V.length;return e.jsxs("button",{type:"button",onClick:()=>H(t+o),className:`${j===s.date?"border-b-2 border-[#95C22B]":"border-b-2 border-transparent"}`,children:[e.jsx("p",{className:"font-inter sm:text-base text-xs font-medium text-center text-[#1A1A1A]",children:s.name}),e.jsx("p",{className:`font-inter sm:text-sm text-xs font-medium text-center ${l>0?"text-[#95C22B]":"text-[#717171]"}`,children:l>0?`${l} Slots Available`:"Click to check"})]},t+o)})}),e.jsx("button",{type:"button",className:"flex justify-center items-center disabled:text-gray-300",onClick:U,disabled:o+3>=r.length,children:e.jsx(Ce,{className:"border w-14 h-14 p-2 sm:p-4 rounded-full"})})]}),e.jsx("div",{className:"mt-3 w-full",children:r.map((s,t)=>{var l;return e.jsx("div",{children:s.slotsAvailable?e.jsxs("div",{className:`grid grid-cols-1 gap-3 ${M===`selected${t}`?"":"hidden"}`,children:[e.jsx(Ae,{title:"Slots",slots:V,selectedSlot:P,handleSlotClick:z,dayDate:s.date}),e.jsx($,{type:"submit",className:"bg-[#95C22B] w-full",children:"Confirm Booking"})]}):e.jsxs("div",{className:`flex flex-col gap-2 items-center w-full ${M===`selected${t}`?"":"hidden"}`,children:[e.jsx("img",{src:Ee,alt:"No slots available"}),e.jsx("p",{className:"font-inter text-[#1A1A1A]",children:"Sorry, no slots available today"}),e.jsxs($,{type:"button",className:"bg-[#95C22B] w-full",onClick:()=>R(t+F(s.date).index),disabled:!F(s.date),children:["Next availability on ",(l=F(s.date))==null?void 0:l.name," "]})]})},t)})})]})]})})]})})})};export{Ge as C,Pe as c};
